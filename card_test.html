<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë“œ ë§ì¶”ê¸° ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            flex-direction: column;
        }
        .container {
            width: 100%;
            max-width: 600px;
            padding: 1.5rem;
            background-color: #2d3748;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .game-board {
            display: grid;
            gap: 0.5rem;
            margin-top: 1rem;
            transition: opacity 0.5s ease-in-out;
        }
        .card {
            aspect-ratio: 1 / 1;
            background-color: #a0aec0;
            border-radius: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: transparent;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            position: relative;
            transform-style: preserve-3d;
        }
        .card.flipped {
            background-color: #fbd38d;
            transform: rotateY(180deg);
        }
        .card.matched {
            background-color: #68d391;
            cursor: default;
            pointer-events: none;
            color: white;
        }
        .card-content {
            position: absolute;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: rotateY(180deg);
            color: #1a202c;
        }
        .card.matched .card-content {
            color: white;
        }
        .card.flipped .card-content {
            color: black;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body class="bg-gray-800 text-gray-200">

    <div class="container text-center">
        <h1 class="text-3xl font-bold mb-4">ì¹´ë“œ ë§ì¶”ê¸° ê²Œì„</h1>
        
        <div class="flex justify-between items-center mb-4">
            <div id="level" class="text-xl font-semibold">ë‹¨ê³„: 1</div>
            <div id="timer" class="text-xl font-semibold">ë‚¨ì€ ì‹œê°„: 20ì´ˆ</div>
        </div>
        
        <div id="game-board" class="game-board"></div>
        
        <div class="mt-6 flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
            <button id="startButton" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-bold transition-all transform hover:scale-105">
                ê²Œì„ ì‹œì‘
            </button>
            <button id="restartButton" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-bold transition-all transform hover:scale-105" disabled>
                ì¬ì‹œì‘
            </button>
            <button id="nextLevelButton" class="hidden px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-bold transition-all transform hover:scale-105">
                ë‹¤ìŒ ë‹¨ê³„ ë„ì „í•˜ê¸°
            </button>
        </div>
        
        <div id="messageBox" class="bg-yellow-800 text-white p-4 rounded-lg mt-4 hidden">
            <p id="messageText"></p>
        </div>

        <!-- ìŠ¤í¬ë¦°ë¦¬ë”ìš© ì‹¤ì‹œê°„ ì•Œë¦¼ ì˜ì—­ -->
        <div id="live-announcer" aria-live="polite" class="sr-only"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const levels = [
                { rows: 2, cols: 2 }, // Stage 1
                { rows: 2, cols: 3 }, // Stage 2
                { rows: 2, cols: 4 }, // Stage 3
                { rows: 2, cols: 4 }, // Stage 4 (Modified to be even)
                { rows: 3, cols: 4 }, // Stage 5
                { rows: 3, cols: 5 }, // Stage 6
                { rows: 4, cols: 4 }, // Stage 7
                { rows: 4, cols: 4 }, // Stage 8
                { rows: 4, cols: 5 }  // Stage 9
            ];
            
            const cardContent = ['ğŸ¶', 'ğŸ±', 'ğŸ°', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ·', 'ğŸ¦Š', 'ğŸ¸', 'ğŸ¦'];
            
            let currentLevel = 0;
            let firstCard = null;
            let secondCard = null;
            let lockBoard = false;
            let matchedPairs = 0;
            let timer;
            const timeLimit = 20;
            let timeRemaining = timeLimit;
            let gameOver = false;

            const startButton = document.getElementById('startButton');
            const restartButton = document.getElementById('restartButton');
            const nextLevelButton = document.getElementById('nextLevelButton');
            const levelDisplay = document.getElementById('level');
            const timerDisplay = document.getElementById('timer');
            const gameBoard = document.getElementById('game-board');
            const liveAnnouncer = document.getElementById('live-announcer');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');

            // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 3000);
            }
            
            // ìŠ¤í¬ë¦°ë¦¬ë”ì—ê²Œ ë©”ì‹œì§€ ì „ë‹¬ í•¨ìˆ˜
            function announceToScreenReader(message) {
                liveAnnouncer.textContent = message;
                // ë©”ì‹œì§€ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ì ì‹œ ë’¤ clear
                setTimeout(() => { liveAnnouncer.textContent = ''; }, 100);
            }

            // ê²Œì„ ë³´ë“œ ìƒì„±
            function createBoard(levelIndex) {
                const { rows, cols } = levels[levelIndex];
                const totalCards = rows * cols;
                const pairs = totalCards / 2;
                
                if (totalCards % 2 !== 0) {
                     showMessage("4ë‹¨ê³„ëŠ” í™€ìˆ˜ì´ë¯€ë¡œ 2x4 (8ì¥)ë¡œ ë³€ê²½í•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
                }

                const contentPairs = cardContent.slice(0, pairs);
                const cardsArray = [...contentPairs, ...contentPairs];
                
                cardsArray.sort(() => 0.5 - Math.random());
                
                gameBoard.innerHTML = '';
                gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                gameBoard.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
                
                let cardIndex = 0;
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const card = document.createElement('button');
                        card.classList.add('card', 'rounded-xl', 'p-4', 'shadow-lg');
                        card.setAttribute('role', 'button');
                        card.setAttribute('aria-label', `${r+1}í–‰ ${c+1}ì—´ ë’¤ì§‘íŒ ì¹´ë“œ`);
                        card.setAttribute('data-content', cardsArray[cardIndex]);
                        card.setAttribute('data-row', r + 1);
                        card.setAttribute('data-col', c + 1);
                        
                        const content = document.createElement('div');
                        content.classList.add('card-content', 'text-6xl');
                        content.textContent = cardsArray[cardIndex];
                        
                        card.appendChild(content);
                        gameBoard.appendChild(card);
                        card.addEventListener('click', flipCard);
                        cardIndex++;
                    }
                }
            }

            // ì¹´ë“œ ë’¤ì§‘ê¸°
            function flipCard() {
                if (lockBoard || this === firstCard || this.classList.contains('matched')) return;
                
                this.classList.add('flipped');
                
                const row = this.getAttribute('data-row');
                const col = this.getAttribute('data-col');
                announceToScreenReader(`${row}í–‰ ${col}ì—´, ${this.getAttribute('data-content')} ì¹´ë“œ`);

                if (!firstCard) {
                    firstCard = this;
                    return;
                }

                secondCard = this;
                checkForMatch();
            }

            // ì§ ë§ì¶”ê¸° í™•ì¸
            function checkForMatch() {
                let isMatch = firstCard.getAttribute('data-content') === secondCard.getAttribute('data-content');
                isMatch ? disableCards() : unflipCards();
            }

            // ì§ì´ ë§ì•˜ì„ ë•Œ
            function disableCards() {
                firstCard.classList.add('matched');
                secondCard.classList.add('matched');
                firstCard.setAttribute('aria-label', firstCard.getAttribute('data-content') + ' ì¹´ë“œ, ì§ì´ ë§ì¶°ì¡ŒìŠµë‹ˆë‹¤.');
                secondCard.setAttribute('aria-label', secondCard.getAttribute('data-content') + ' ì¹´ë“œ, ì§ì´ ë§ì¶°ì¡ŒìŠµë‹ˆë‹¤.');
                
                firstCard.removeEventListener('click', flipCard);
                secondCard.removeEventListener('click', flipCard);
                
                announceToScreenReader('ì§ì´ ë§ì•˜ìŠµë‹ˆë‹¤!');

                matchedPairs++;
                const totalPairs = (levels[currentLevel].rows * levels[currentLevel].cols) / 2;
                if (matchedPairs === totalPairs) {
                    endGame('win');
                }
                
                resetBoard();
            }

            // ì§ì´ í‹€ë ¸ì„ ë•Œ
            function unflipCards() {
                lockBoard = true;
                setTimeout(() => {
                    firstCard.classList.remove('flipped');
                    secondCard.classList.remove('flipped');
                    firstCard.setAttribute('aria-label', firstCard.getAttribute('data-row') + 'í–‰ ' + firstCard.getAttribute('data-col') + 'ì—´ ë’¤ì§‘íŒ ì¹´ë“œ');
                    secondCard.setAttribute('aria-label', secondCard.getAttribute('data-row') + 'í–‰ ' + secondCard.getAttribute('data-col') + 'ì—´ ë’¤ì§‘íŒ ì¹´ë“œ');
                    
                    announceToScreenReader('ì§ì´ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                    resetBoard();
                }, 1000);
            }

            // ë³´ë“œ ì´ˆê¸°í™”
            function resetBoard() {
                [firstCard, secondCard, lockBoard] = [null, null, false];
            }
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            function startTimer() {
                timeRemaining = timeLimit;
                timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeRemaining}ì´ˆ`;
                clearInterval(timer);
                timer = setInterval(() => {
                    timeRemaining--;
                    timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeRemaining}ì´ˆ`;
                    if (timeRemaining <= 0) {
                        endGame('lose');
                    }
                }, 1000);
            }

            // ê²Œì„ ì‹œì‘
            function startGame() {
                gameOver = false;
                startButton.classList.add('hidden');
                nextLevelButton.classList.add('hidden');
                restartButton.classList.remove('hidden');
                restartButton.disabled = false;
                matchedPairs = 0;
                
                createBoard(currentLevel);
                startTimer();
                announceToScreenReader('ê²Œì„ ì‹œì‘! ' + (currentLevel + 1) + 'ë‹¨ê³„. ëª¨ë“  ì¹´ë“œë¥¼ ë§ì¶°ì£¼ì„¸ìš”.');
            }

            // ê²Œì„ ì¢…ë£Œ
            function endGame(status) {
                gameOver = true;
                clearInterval(timer);
                startButton.classList.remove('hidden');
                
                if (status === 'win') {
                    if (currentLevel < levels.length - 1) {
                        showMessage('ì„±ê³µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        announceToScreenReader('ì„±ê³µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        startButton.classList.add('hidden');
                        nextLevelButton.classList.remove('hidden');
                        nextLevelButton.textContent = `${currentLevel + 2}ë‹¨ê³„ ë„ì „í•˜ê¸°`;
                    } else {
                        showMessage('ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¨ê³„ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤!');
                        announceToScreenReader('ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¨ê³„ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤!');
                    }
                } else if (status === 'lose') {
                    showMessage('ì‹œê°„ ì´ˆê³¼! ê²Œì„ ì˜¤ë²„!');
                    announceToScreenReader('ì‹œê°„ ì´ˆê³¼! ê²Œì„ ì˜¤ë²„!');
                }
            }
            
            // ì¬ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ
            restartButton.addEventListener('click', () => {
                currentLevel = 0;
                levelDisplay.textContent = `ë‹¨ê³„: ${currentLevel + 1}`;
                startButton.textContent = 'ê²Œì„ ì‹œì‘';
                nextLevelButton.classList.add('hidden');
                startButton.classList.remove('hidden');
                restartButton.classList.add('hidden');
                startGame();
            });

            // ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ
            startButton.addEventListener('click', () => {
                startGame();
            });
            
            // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í´ë¦­ ì‹œ
            nextLevelButton.addEventListener('click', () => {
                currentLevel++;
                levelDisplay.textContent = `ë‹¨ê³„: ${currentLevel + 1}`;
                startGame();
            });

            // ì´ˆê¸° ë³´ë“œ ìƒì„± ë° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            createBoard(currentLevel);
            restartButton.classList.add('hidden');
        });
    </script>
</body>
</html>
